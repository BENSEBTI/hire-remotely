<!DOCTYPE html>
<html ng-app>
  <head>
    <title>Hire Remotely | Find remote tech jobs</title>

    <!-- Viewport mobile tag for sensible mobile support -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <!--STYLES-->
    <link rel="stylesheet" href="/linker/styles/animate.css">
    <link rel="stylesheet" href="/linker/styles/bootstrap.min.css">
    <link rel="stylesheet" href="/linker/styles/custom.css">
    <!--STYLES END-->
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <script src="https://checkout.stripe.com/checkout.js"></script>
  </head>

  <body style="padding-top:90px;">
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/"><img src="/images/logo.png"></a>
  </div>

  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav navbar-right">
      <li><a href="/">All Jobs</a></li>
      <% if (session.authenticated && session.User.admin) { %>
        <!-- <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Users <b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a href="/user">All Users</a></li>
            <li><a href="/user/new">New User</a></li>
          </ul>
        </li> -->
      <% } %>

      <% if (session.authenticated) { %>
      <li><a href="/post/all">My Job Posts</a></li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><%= session.User.email %> <b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li><a href="/session/destroy">Sign Out</a></li>
        </ul>
      </li>
      <% } %>

      <% if (!session.authenticated) { %>
      <li><a href="/session/new">Sign In</a></li>
      <% } %>
      <li><a href="/post" id="postJob">Post a Job</a></li>
    </ul>
  </div><!-- /.navbar-collapse -->
</nav>

    <%- body %>

    <!--SCRIPTS-->
    <script src="/linker/js/socket.io.js"></script>
    <script src="/linker/js/sails.io.js"></script>
    <script src="/linker/js/app.js"></script>
    <script src="/linker/js/jquery.min.js"></script>
    <script src="/linker/js/bootstrap.min.js"></script>
    <script src="/linker/js/jquery.hotkeys.js"></script>
    <script src="/linker/js/bootstrap.wysiwyg.js"></script>
    <script src="/linker/js/moment.min.js"></script>
    <!--SCRIPTS END-->

    <script type="text/javascript">
      setTimeout(function(){
        $('.createdAt').css({
          opacity: '1'
        });
      }, 100);
      var getTime = function() {
        var now = moment();
        $('.createdAt').each(function(i, e) {
            var time = moment($(e).attr('datetime'));
            var doy = time.dayOfYear();
            var todaystime = moment().dayOfYear();
            var diff = todaystime - doy;
            if(diff > 30) {
              var jobIDs = $(this).attr('data-job');
              $.ajax({
                type: 'POST',
                url: '/post/setToInactive',
                data: {
                  jobIDs: jobIDs
                }
              });
            }
            $(e).text(time.from(now));
        });
      };
      $(document).ready(function(){
        getTime();
        setInterval(getTime, 600000);
        var i = $('.jobTitle').length;
        if(i == 0) {
          $('.resultsCount').append('No jobs were found');
        }
        else if(i == 1) {
          $('.resultsCount').append(i + ' job found');
        }
        else {
          $('.resultsCount').append(i + ' jobs found');
        }
      });
      $('.viewJob').each(function(){
        $(this).on('click', function(){
          var jobID = $(this).attr('data-job');
          $.ajax({
            type: 'POST',
            url: '/post/addView',
            data: {
              jobID: jobID
            } 
          });
        });
      });
      $('.jobSubmission').each(function(){
        $(this).on('click', function(){
          var jobID = $(this).attr('data-job');
          $.ajax({
            type: 'POST',
            url: '/post/addSubmission',
            data: {
              jobID: jobID
            } 
          });
        });
      });

      $('#editor').wysiwyg();
      $('.stripe-button-el, .savePost').click(function(){
        var html = $('#editor').cleanHtml();
        var param = "<input type='text' style='display:none' name='jobDescription' value='" + html + "' />";
        $("#postSubmit").append(param);
      }); 

      // GET JOB DESCRIPTION HTML AND APPEND
      var postHtml = $('.getHtml').text();
      $('.job-info').append(postHtml);
      var postHtml = $('.getHtml').text();
      $('#editor').append(postHtml);

      var postBody = $('.posts');
      if (postBody.children().length == 0) {
        $('.posts').append('<h3 class="noPosts">No job listings just yet</h3>');
      }

      
  </script>


  </body>
</html>
